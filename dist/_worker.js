var at=async(t,e=Object.create(null))=>{const{all:r=!1,dot:s=!1}=e,i=(t instanceof G?t.raw.headers:t.headers).get("Content-Type");return i?.startsWith("multipart/form-data")||i?.startsWith("application/x-www-form-urlencoded")?ct(t,{all:r,dot:s}):{}};async function ct(t,e){const r=await t.formData();return r?ht(r,e):{}}function ht(t,e){const r=Object.create(null);return t.forEach((s,n)=>{e.all||n.endsWith("[]")?lt(r,n,s):r[n]=s}),e.dot&&Object.entries(r).forEach(([s,n])=>{s.includes(".")&&(ut(r,s,n),delete r[s])}),r}var lt=(t,e,r)=>{t[e]!==void 0?Array.isArray(t[e])?t[e].push(r):t[e]=[t[e],r]:t[e]=r},ut=(t,e,r)=>{let s=t;const n=e.split(".");n.forEach((i,h)=>{h===n.length-1?s[i]=r:((!s[i]||typeof s[i]!="object"||Array.isArray(s[i])||s[i]instanceof File)&&(s[i]=Object.create(null)),s=s[i])})},K=t=>{const e=t.split("/");return e[0]===""&&e.shift(),e},ft=t=>{const{groups:e,path:r}=dt(t),s=K(r);return pt(s,e)},dt=t=>{const e=[];return t=t.replace(/\{[^}]+\}/g,(r,s)=>{const n=`@${s}`;return e.push([n,r]),n}),{groups:e,path:t}},pt=(t,e)=>{for(let r=e.length-1;r>=0;r--){const[s]=e[r];for(let n=t.length-1;n>=0;n--)if(t[n].includes(s)){t[n]=t[n].replace(s,e[r][1]);break}}return t},C={},T=(t,e)=>{if(t==="*")return"*";const r=t.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);if(r){const s=`${t}#${e}`;return C[s]||(r[2]?C[s]=e&&e[0]!==":"&&e[0]!=="*"?[s,r[1],new RegExp(`^${r[2]}(?=/${e})`)]:[t,r[1],new RegExp(`^${r[2]}$`)]:C[s]=[t,r[1],!0]),C[s]}return null},W=(t,e)=>{try{return e(t)}catch{return t.replace(/(?:%[0-9A-Fa-f]{2})+/g,r=>{try{return e(r)}catch{return r}})}},gt=t=>W(t,decodeURI),B=t=>{const e=t.url,r=e.indexOf("/",8);let s=r;for(;s<e.length;s++){const n=e.charCodeAt(s);if(n===37){const i=e.indexOf("?",s),h=e.slice(r,i===-1?void 0:i);return gt(h.includes("%25")?h.replace(/%25/g,"%2525"):h)}else if(n===63)break}return e.slice(r,s)},yt=t=>{const e=B(t);return e.length>1&&e.at(-1)==="/"?e.slice(0,-1):e},O=(...t)=>{let e="",r=!1;for(let s of t)e.at(-1)==="/"&&(e=e.slice(0,-1),r=!0),s[0]!=="/"&&(s=`/${s}`),s==="/"&&r?e=`${e}/`:s!=="/"&&(e=`${e}${s}`),s==="/"&&e===""&&(e="/");return e},q=t=>{if(!t.match(/\:.+\?$/))return null;const e=t.split("/"),r=[];let s="";return e.forEach(n=>{if(n!==""&&!/\:/.test(n))s+="/"+n;else if(/\:/.test(n))if(/\?/.test(n)){r.length===0&&s===""?r.push("/"):r.push(s);const i=n.replace("?","");s+="/"+i,r.push(s)}else s+="/"+n}),r.filter((n,i,h)=>h.indexOf(n)===i)},L=t=>/[%+]/.test(t)?(t.indexOf("+")!==-1&&(t=t.replace(/\+/g," ")),t.indexOf("%")!==-1?V(t):t):t,z=(t,e,r)=>{let s;if(!r&&e&&!/[%+]/.test(e)){let h=t.indexOf(`?${e}`,8);for(h===-1&&(h=t.indexOf(`&${e}`,8));h!==-1;){const c=t.charCodeAt(h+e.length+1);if(c===61){const o=h+e.length+2,a=t.indexOf("&",o);return L(t.slice(o,a===-1?void 0:a))}else if(c==38||isNaN(c))return"";h=t.indexOf(`&${e}`,h+1)}if(s=/[%+]/.test(t),!s)return}const n={};s??=/[%+]/.test(t);let i=t.indexOf("?",8);for(;i!==-1;){const h=t.indexOf("&",i+1);let c=t.indexOf("=",i);c>h&&h!==-1&&(c=-1);let o=t.slice(i+1,c===-1?h===-1?void 0:h:c);if(s&&(o=L(o)),i=h,o==="")continue;let a;c===-1?a="":(a=t.slice(c+1,h===-1?void 0:h),s&&(a=L(a))),r?(n[o]&&Array.isArray(n[o])||(n[o]=[]),n[o].push(a)):n[o]??=a}return e?n[e]:n},wt=z,bt=(t,e)=>z(t,e,!0),V=decodeURIComponent,F=t=>W(t,V),G=class{raw;#e;#t;routeIndex=0;path;bodyCache={};constructor(t,e="/",r=[[]]){this.raw=t,this.path=e,this.#t=r,this.#e={}}param(t){return t?this.#r(t):this.#i()}#r(t){const e=this.#t[0][this.routeIndex][1][t],r=this.#n(e);return r?/\%/.test(r)?F(r):r:void 0}#i(){const t={},e=Object.keys(this.#t[0][this.routeIndex][1]);for(const r of e){const s=this.#n(this.#t[0][this.routeIndex][1][r]);s&&typeof s=="string"&&(t[r]=/\%/.test(s)?F(s):s)}return t}#n(t){return this.#t[1]?this.#t[1][t]:t}query(t){return wt(this.url,t)}queries(t){return bt(this.url,t)}header(t){if(t)return this.raw.headers.get(t)??void 0;const e={};return this.raw.headers.forEach((r,s)=>{e[s]=r}),e}async parseBody(t){return this.bodyCache.parsedBody??=await at(this,t)}#s=t=>{const{bodyCache:e,raw:r}=this,s=e[t];if(s)return s;const n=Object.keys(e)[0];return n?e[n].then(i=>(n==="json"&&(i=JSON.stringify(i)),new Response(i)[t]())):e[t]=r[t]()};json(){return this.#s("json")}text(){return this.#s("text")}arrayBuffer(){return this.#s("arrayBuffer")}blob(){return this.#s("blob")}formData(){return this.#s("formData")}addValidatedData(t,e){this.#e[t]=e}valid(t){return this.#e[t]}get url(){return this.raw.url}get method(){return this.raw.method}get matchedRoutes(){return this.#t[0].map(([[,t]])=>t)}get routePath(){return this.#t[0].map(([[,t]])=>t)[this.routeIndex].path}},Rt={Stringify:1},Q=async(t,e,r,s,n)=>{typeof t=="object"&&!(t instanceof String)&&(t instanceof Promise||(t=t.toString()),t instanceof Promise&&(t=await t));const i=t.callbacks;return i?.length?(n?n[0]+=t:n=[t],Promise.all(i.map(c=>c({phase:e,buffer:n,context:s}))).then(c=>Promise.all(c.filter(Boolean).map(o=>Q(o,e,!1,s,n))).then(()=>n[0]))):Promise.resolve(t)},mt="text/plain; charset=UTF-8",N=(t,e={})=>{for(const r of Object.keys(e))t.set(r,e[r]);return t},X=class{#e;#t;env={};#r;finalized=!1;error;#i=200;#n;#s;#o;#c;#h=!0;#f;#l;#u;#d;#p;constructor(t,e){this.#e=t,e&&(this.#n=e.executionCtx,this.env=e.env,this.#u=e.notFoundHandler,this.#p=e.path,this.#d=e.matchResult)}get req(){return this.#t??=new G(this.#e,this.#p,this.#d),this.#t}get event(){if(this.#n&&"respondWith"in this.#n)return this.#n;throw Error("This context has no FetchEvent")}get executionCtx(){if(this.#n)return this.#n;throw Error("This context has no ExecutionContext")}get res(){return this.#h=!1,this.#c||=new Response("404 Not Found",{status:404})}set res(t){if(this.#h=!1,this.#c&&t)try{for(const[e,r]of this.#c.headers.entries())if(e!=="content-type")if(e==="set-cookie"){const s=this.#c.headers.getSetCookie();t.headers.delete("set-cookie");for(const n of s)t.headers.append("set-cookie",n)}else t.headers.set(e,r)}catch(e){if(e instanceof TypeError&&e.message.includes("immutable")){this.res=new Response(t.body,{headers:t.headers,status:t.status});return}else throw e}this.#c=t,this.finalized=!0}render=(...t)=>(this.#l??=e=>this.html(e),this.#l(...t));setLayout=t=>this.#f=t;getLayout=()=>this.#f;setRenderer=t=>{this.#l=t};header=(t,e,r)=>{if(e===void 0){this.#s?this.#s.delete(t):this.#o&&delete this.#o[t.toLocaleLowerCase()],this.finalized&&this.res.headers.delete(t);return}r?.append?(this.#s||(this.#h=!1,this.#s=new Headers(this.#o),this.#o={}),this.#s.append(t,e)):this.#s?this.#s.set(t,e):(this.#o??={},this.#o[t.toLowerCase()]=e),this.finalized&&(r?.append?this.res.headers.append(t,e):this.res.headers.set(t,e))};status=t=>{this.#h=!1,this.#i=t};set=(t,e)=>{this.#r??=new Map,this.#r.set(t,e)};get=t=>this.#r?this.#r.get(t):void 0;get var(){return this.#r?Object.fromEntries(this.#r):{}}#a(t,e,r){if(this.#h&&!r&&!e&&this.#i===200)return new Response(t,{headers:this.#o});if(e&&typeof e!="number"){const n=new Headers(e.headers);this.#s&&this.#s.forEach((h,c)=>{c==="set-cookie"?n.append(c,h):n.set(c,h)});const i=N(n,this.#o);return new Response(t,{headers:i,status:e.status??this.#i})}const s=typeof e=="number"?e:this.#i;this.#o??={},this.#s??=new Headers,N(this.#s,this.#o),this.#c&&(this.#c.headers.forEach((n,i)=>{i==="set-cookie"?this.#s?.append(i,n):this.#s?.set(i,n)}),N(this.#s,this.#o)),r??={};for(const[n,i]of Object.entries(r))if(typeof i=="string")this.#s.set(n,i);else{this.#s.delete(n);for(const h of i)this.#s.append(n,h)}return new Response(t,{status:s,headers:this.#s})}newResponse=(...t)=>this.#a(...t);body=(t,e,r)=>typeof e=="number"?this.#a(t,e,r):this.#a(t,e);text=(t,e,r)=>{if(!this.#o){if(this.#h&&!r&&!e)return new Response(t);this.#o={}}return this.#o["content-type"]=mt,typeof e=="number"?this.#a(t,e,r):this.#a(t,e)};json=(t,e,r)=>{const s=JSON.stringify(t);return this.#o??={},this.#o["content-type"]="application/json",typeof e=="number"?this.#a(s,e,r):this.#a(s,e)};html=(t,e,r)=>(this.#o??={},this.#o["content-type"]="text/html; charset=UTF-8",typeof t=="object"?Q(t,Rt.Stringify,!1,{}).then(s=>typeof e=="number"?this.#a(s,e,r):this.#a(s,e)):typeof e=="number"?this.#a(t,e,r):this.#a(t,e));redirect=(t,e)=>(this.#s??=new Headers,this.#s.set("Location",String(t)),this.newResponse(null,e??302));notFound=()=>(this.#u??=()=>new Response,this.#u(this))},k=(t,e,r)=>(s,n)=>{let i=-1;const h=s instanceof X;return c(0);async function c(o){if(o<=i)throw new Error("next() called multiple times");i=o;let a,l=!1,u;if(t[o]?(u=t[o][0][0],h&&(s.req.routeIndex=o)):u=o===t.length&&n||void 0,!u)h&&s.finalized===!1&&r&&(a=await r(s));else try{a=await u(s,()=>c(o+1))}catch(f){if(f instanceof Error&&h&&e)s.error=f,a=await e(f,s),l=!0;else throw f}return a&&(s.finalized===!1||l)&&(s.res=a),s}},p="ALL",vt="all",Et=["get","post","put","delete","options","patch"],J="Can not add a route since the matcher is already built.",Y=class extends Error{},xt="__COMPOSED_HANDLER",Ot=t=>t.text("404 Not Found",404),M=(t,e)=>"getResponse"in t?t.getResponse():(console.error(t),e.text("Internal Server Error",500)),Z=class{get;post;put;delete;options;patch;all;on;use;router;getPath;_basePath="/";#e="/";routes=[];constructor(e={}){[...Et,vt].forEach(n=>{this[n]=(i,...h)=>(typeof i=="string"?this.#e=i:this.#i(n,this.#e,i),h.forEach(c=>{this.#i(n,this.#e,c)}),this)}),this.on=(n,i,...h)=>{for(const c of[i].flat()){this.#e=c;for(const o of[n].flat())h.map(a=>{this.#i(o.toUpperCase(),this.#e,a)})}return this},this.use=(n,...i)=>(typeof n=="string"?this.#e=n:(this.#e="*",i.unshift(n)),i.forEach(h=>{this.#i(p,this.#e,h)}),this);const s=e.strict??!0;delete e.strict,Object.assign(this,e),this.getPath=s?e.getPath??B:yt}#t(){const e=new Z({router:this.router,getPath:this.getPath});return e.routes=this.routes,e}#r=Ot;errorHandler=M;route(e,r){const s=this.basePath(e);return r.routes.map(n=>{let i;r.errorHandler===M?i=n.handler:(i=async(h,c)=>(await k([],r.errorHandler)(h,()=>n.handler(h,c))).res,i[xt]=n.handler),s.#i(n.method,n.path,i)}),this}basePath(e){const r=this.#t();return r._basePath=O(this._basePath,e),r}onError=e=>(this.errorHandler=e,this);notFound=e=>(this.#r=e,this);mount(e,r,s){let n,i;s&&(typeof s=="function"?i=s:(i=s.optionHandler,n=s.replaceRequest));const h=i?o=>{const a=i(o);return Array.isArray(a)?a:[a]}:o=>{let a;try{a=o.executionCtx}catch{}return[o.env,a]};n||=(()=>{const o=O(this._basePath,e),a=o==="/"?0:o.length;return l=>{const u=new URL(l.url);return u.pathname=u.pathname.slice(a)||"/",new Request(u,l)}})();const c=async(o,a)=>{const l=await r(n(o.req.raw),...h(o));if(l)return l;await a()};return this.#i(p,O(e,"*"),c),this}#i(e,r,s){e=e.toUpperCase(),r=O(this._basePath,r);const n={path:r,method:e,handler:s};this.router.add(e,r,[s,n]),this.routes.push(n)}#n(e,r){if(e instanceof Error)return this.errorHandler(e,r);throw e}#s(e,r,s,n){if(n==="HEAD")return(async()=>new Response(null,await this.#s(e,r,s,"GET")))();const i=this.getPath(e,{env:s}),h=this.router.match(n,i),c=new X(e,{path:i,matchResult:h,env:s,executionCtx:r,notFoundHandler:this.#r});if(h[0].length===1){let a;try{a=h[0][0][0][0](c,async()=>{c.res=await this.#r(c)})}catch(l){return this.#n(l,c)}return a instanceof Promise?a.then(l=>l||(c.finalized?c.res:this.#r(c))).catch(l=>this.#n(l,c)):a??this.#r(c)}const o=k(h[0],this.errorHandler,this.#r);return(async()=>{try{const a=await o(c);if(!a.finalized)throw new Error("Context is not finalized. Did you forget to return a Response object or `await next()`?");return a.res}catch(a){return this.#n(a,c)}})()}fetch=(e,...r)=>this.#s(e,r[1],r[0],e.method);request=(e,r,s,n)=>e instanceof Request?this.fetch(r?new Request(e,r):e,s,n):(e=e.toString(),this.fetch(new Request(/^https?:\/\//.test(e)?e:`http://localhost${O("/",e)}`,r),s,n));fire=()=>{addEventListener("fetch",e=>{e.respondWith(this.#s(e.request,e,void 0,e.request.method))})}},H="[^/]+",S=".*",A="(?:|/.*)",P=Symbol(),jt=new Set(".\\+*[^]$()");function Pt(t,e){return t.length===1?e.length===1?t<e?-1:1:-1:e.length===1||t===S||t===A?1:e===S||e===A?-1:t===H?1:e===H?-1:t.length===e.length?t<e?-1:1:e.length-t.length}var _=class{#e;#t;#r=Object.create(null);insert(e,r,s,n,i){if(e.length===0){if(this.#e!==void 0)throw P;if(i)return;this.#e=r;return}const[h,...c]=e,o=h==="*"?c.length===0?["","",S]:["","",H]:h==="/*"?["","",A]:h.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);let a;if(o){const l=o[1];let u=o[2]||H;if(l&&o[2]&&(u=u.replace(/^\((?!\?:)(?=[^)]+\)$)/,"(?:"),/\((?!\?:)/.test(u)))throw P;if(a=this.#r[u],!a){if(Object.keys(this.#r).some(f=>f!==S&&f!==A))throw P;if(i)return;a=this.#r[u]=new _,l!==""&&(a.#t=n.varIndex++)}!i&&l!==""&&s.push([l,a.#t])}else if(a=this.#r[h],!a){if(Object.keys(this.#r).some(l=>l.length>1&&l!==S&&l!==A))throw P;if(i)return;a=this.#r[h]=new _}a.insert(c,r,s,n,i)}buildRegExpStr(){const r=Object.keys(this.#r).sort(Pt).map(s=>{const n=this.#r[s];return(typeof n.#t=="number"?`(${s})@${n.#t}`:jt.has(s)?`\\${s}`:s)+n.buildRegExpStr()});return typeof this.#e=="number"&&r.unshift(`#${this.#e}`),r.length===0?"":r.length===1?r[0]:"(?:"+r.join("|")+")"}},St=class{#e={varIndex:0};#t=new _;insert(t,e,r){const s=[],n=[];for(let h=0;;){let c=!1;if(t=t.replace(/\{[^}]+\}/g,o=>{const a=`@\\${h}`;return n[h]=[a,o],h++,c=!0,a}),!c)break}const i=t.match(/(?::[^\/]+)|(?:\/\*$)|./g)||[];for(let h=n.length-1;h>=0;h--){const[c]=n[h];for(let o=i.length-1;o>=0;o--)if(i[o].indexOf(c)!==-1){i[o]=i[o].replace(c,n[h][1]);break}}return this.#t.insert(i,e,s,this.#e,r),s}buildRegExp(){let t=this.#t.buildRegExpStr();if(t==="")return[/^$/,[],[]];let e=0;const r=[],s=[];return t=t.replace(/#(\d+)|@(\d+)|\.\*\$/g,(n,i,h)=>i!==void 0?(r[++e]=Number(i),"$()"):(h!==void 0&&(s[Number(h)]=++e),"")),[new RegExp(`^${t}`),r,s]}},tt=[],At=[/^$/,[],Object.create(null)],et=Object.create(null);function st(t){return et[t]??=new RegExp(t==="*"?"":`^${t.replace(/\/\*$|([.\\+*[^\]$()])/g,(e,r)=>r?`\\${r}`:"(?:|/.*)")}$`)}function $t(){et=Object.create(null)}function Ct(t){const e=new St,r=[];if(t.length===0)return At;const s=t.map(a=>[!/\*|\/:/.test(a[0]),...a]).sort(([a,l],[u,f])=>a?1:u?-1:l.length-f.length),n=Object.create(null);for(let a=0,l=-1,u=s.length;a<u;a++){const[f,g,d]=s[a];f?n[g]=[d.map(([w])=>[w,Object.create(null)]),tt]:l++;let y;try{y=e.insert(g,l,f)}catch(w){throw w===P?new Y(g):w}f||(r[l]=d.map(([w,v])=>{const x=Object.create(null);for(v-=1;v>=0;v--){const[b,D]=y[v];x[b]=D}return[w,x]}))}const[i,h,c]=e.buildRegExp();for(let a=0,l=r.length;a<l;a++)for(let u=0,f=r[a].length;u<f;u++){const g=r[a][u]?.[1];if(!g)continue;const d=Object.keys(g);for(let y=0,w=d.length;y<w;y++)g[d[y]]=c[g[d[y]]]}const o=[];for(const a in h)o[a]=r[h[a]];return[i,o,n]}function E(t,e){if(t){for(const r of Object.keys(t).sort((s,n)=>n.length-s.length))if(st(r).test(e))return[...t[r]]}}var Ht=class{name="RegExpRouter";#e;#t;constructor(){this.#e={[p]:Object.create(null)},this.#t={[p]:Object.create(null)}}add(t,e,r){const s=this.#e,n=this.#t;if(!s||!n)throw new Error(J);s[t]||[s,n].forEach(c=>{c[t]=Object.create(null),Object.keys(c[p]).forEach(o=>{c[t][o]=[...c[p][o]]})}),e==="/*"&&(e="*");const i=(e.match(/\/:/g)||[]).length;if(/\*$/.test(e)){const c=st(e);t===p?Object.keys(s).forEach(o=>{s[o][e]||=E(s[o],e)||E(s[p],e)||[]}):s[t][e]||=E(s[t],e)||E(s[p],e)||[],Object.keys(s).forEach(o=>{(t===p||t===o)&&Object.keys(s[o]).forEach(a=>{c.test(a)&&s[o][a].push([r,i])})}),Object.keys(n).forEach(o=>{(t===p||t===o)&&Object.keys(n[o]).forEach(a=>c.test(a)&&n[o][a].push([r,i]))});return}const h=q(e)||[e];for(let c=0,o=h.length;c<o;c++){const a=h[c];Object.keys(n).forEach(l=>{(t===p||t===l)&&(n[l][a]||=[...E(s[l],a)||E(s[p],a)||[]],n[l][a].push([r,i-o+c+1]))})}}match(t,e){$t();const r=this.#r();return this.match=(s,n)=>{const i=r[s]||r[p],h=i[2][n];if(h)return h;const c=n.match(i[0]);if(!c)return[[],tt];const o=c.indexOf("",1);return[i[1][o],c]},this.match(t,e)}#r(){const t=Object.create(null);return Object.keys(this.#t).concat(Object.keys(this.#e)).forEach(e=>{t[e]||=this.#i(e)}),this.#e=this.#t=void 0,t}#i(t){const e=[];let r=t===p;return[this.#e,this.#t].forEach(s=>{const n=s[t]?Object.keys(s[t]).map(i=>[i,s[t][i]]):[];n.length!==0?(r||=!0,e.push(...n)):t!==p&&e.push(...Object.keys(s[p]).map(i=>[i,s[p][i]]))}),r?Ct(e):null}},Dt=class{name="SmartRouter";#e=[];#t=[];constructor(t){this.#e=t.routers}add(t,e,r){if(!this.#t)throw new Error(J);this.#t.push([t,e,r])}match(t,e){if(!this.#t)throw new Error("Fatal error");const r=this.#e,s=this.#t,n=r.length;let i=0,h;for(;i<n;i++){const c=r[i];try{for(let o=0,a=s.length;o<a;o++)c.add(...s[o]);h=c.match(t,e)}catch(o){if(o instanceof Y)continue;throw o}this.match=c.match.bind(c),this.#e=[c],this.#t=void 0;break}if(i===n)throw new Error("Fatal error");return this.name=`SmartRouter + ${this.activeRouter.name}`,h}get activeRouter(){if(this.#t||this.#e.length!==1)throw new Error("No active router has been determined yet.");return this.#e[0]}},j=Object.create(null),rt=class{#e;#t;#r;#i=0;#n=j;constructor(t,e,r){if(this.#t=r||Object.create(null),this.#e=[],t&&e){const s=Object.create(null);s[t]={handler:e,possibleKeys:[],score:0},this.#e=[s]}this.#r=[]}insert(t,e,r){this.#i=++this.#i;let s=this;const n=ft(e),i=[];for(let o=0,a=n.length;o<a;o++){const l=n[o],u=n[o+1],f=T(l,u),g=Array.isArray(f)?f[0]:l;if(Object.keys(s.#t).includes(g)){s=s.#t[g];const d=T(l,u);d&&i.push(d[1]);continue}s.#t[g]=new rt,f&&(s.#r.push(f),i.push(f[1])),s=s.#t[g]}const h=Object.create(null),c={handler:r,possibleKeys:i.filter((o,a,l)=>l.indexOf(o)===a),score:this.#i};return h[t]=c,s.#e.push(h),s}#s(t,e,r,s){const n=[];for(let i=0,h=t.#e.length;i<h;i++){const c=t.#e[i],o=c[e]||c[p],a={};if(o!==void 0&&(o.params=Object.create(null),n.push(o),r!==j||s&&s!==j))for(let l=0,u=o.possibleKeys.length;l<u;l++){const f=o.possibleKeys[l],g=a[o.score];o.params[f]=s?.[f]&&!g?s[f]:r[f]??s?.[f],a[o.score]=!0}}return n}search(t,e){const r=[];this.#n=j;let n=[this];const i=K(e),h=[];for(let c=0,o=i.length;c<o;c++){const a=i[c],l=c===o-1,u=[];for(let f=0,g=n.length;f<g;f++){const d=n[f],y=d.#t[a];y&&(y.#n=d.#n,l?(y.#t["*"]&&r.push(...this.#s(y.#t["*"],t,d.#n)),r.push(...this.#s(y,t,d.#n))):u.push(y));for(let w=0,v=d.#r.length;w<v;w++){const x=d.#r[w],b=d.#n===j?{}:{...d.#n};if(x==="*"){const m=d.#t["*"];m&&(r.push(...this.#s(m,t,d.#n)),m.#n=b,u.push(m));continue}if(a==="")continue;const[D,I,$]=x,R=d.#t[D],it=i.slice(c).join("/");if($ instanceof RegExp){const m=$.exec(it);if(m){if(b[I]=m[0],r.push(...this.#s(R,t,d.#n,b)),Object.keys(R.#t).length){R.#n=b;const ot=m[0].match(/\//)?.length??0;(h[ot]||=[]).push(R)}continue}}($===!0||$.test(a))&&(b[I]=a,l?(r.push(...this.#s(R,t,b,d.#n)),R.#t["*"]&&r.push(...this.#s(R.#t["*"],t,b,d.#n))):(R.#n=b,u.push(R)))}}n=u.concat(h.shift()??[])}return r.length>1&&r.sort((c,o)=>c.score-o.score),[r.map(({handler:c,params:o})=>[c,o])]}},Lt=class{name="TrieRouter";#e;constructor(){this.#e=new rt}add(t,e,r){const s=q(e);if(s){for(let n=0,i=s.length;n<i;n++)this.#e.insert(t,s[n],r);return}this.#e.insert(t,e,r)}match(t,e){return this.#e.search(t,e)}},Nt=class extends Z{constructor(t={}){super(t),this.router=t.router??new Dt({routers:[new Ht,new Lt]})}};const U=new Nt,_t=Object.assign({});let nt=!1;for(const[,t]of Object.entries(_t))t&&(U.route("/",t),U.notFound(t.notFoundHandler),nt=!0);if(!nt)throw new Error("Can't import modules from ['/src/index.tsx','/app/server.ts']");export{U as default};
